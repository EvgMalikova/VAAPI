<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VAAPI: Main logic and similarities with VTK API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VAAPI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Main logic and similarities with VTK API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The basics of API use and main concept that is much simillar to <a href="http://vtk.org">Visualisation Toolkit</a>. VTK is defacto a standard for general proglems of visual analysis solving. It's integration with VTK-m provides other dimension to the API efficient computation and integration with simulation software.</p>
<p>The proposed Visual-auditory API targets multisensory interaction problem, unified on base of ray-casting. It is first of all is a research project that targets to explore a unified approach to multisensory feedback on base of ray-casting procedure. Similarity to VTK syntacsis targets to provide user and potential further developers easy entry access to API and of course the author is quite familiar with VTK and that's why providing similar sintacsis in API seemed to him quite logical. The main target of the proposed API: provide a base for further Multisensory interfaces development on base of Ray-casting procedure.</p>
<p>The core of the VTK is a visualisation pipeline of data, that starts from data source and ends up with image rendered on screen.</p>
<p>Below are basic similarities and differences with VTK in the main concept The basic classes of VTK API are:</p><ul>
<li>Sources</li>
<li>Filters</li>
<li>Mappers</li>
<li>Actors</li>
<li>Renderers</li>
<li>Interactors</li>
<li>Windows</li>
</ul>
<p>The proposed solution targets visual-auditory ray-casting of scalar fields. We believe that for this type of data, there is no need to reimplement a large "filtering" part in visualisation pipeline of VTK. The most of scalar fields data preprecessing tasks are already addressed with Image Processing tookit <a href="http::itk.org">ITK</a>. As a result the API mainly provides only targets mapping and rendering tasts and suggests some data reading and preprocessing procedures can be implemented on base of ITK or from scratch.</p>
<p>The Visual-auditory API implements basic Mappers, Actors, Renderers and Windows that are intended to support ray-casting of mainly Signed Distance Fields, althought triangulated geometry is also supported and can be integrated within pipeline. Similarly to VTK the pipeline is constructed through "input-output" concept. The scalar field data is provided by file Readers that eighter output structured data or directly create Optix Buffers and TextureSamplers on GPU. The inputs and outputs are usually Optix objects, like optix::Geometry, optix::Material, optix::GeometryInstance and etc.. As all this objects are created through optix::Context, the reference to it is given to each class. For context creation a ContextManager class is responsible.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Data readers and SDF geometry creation</h1>
<p>In the example below, the Reader that reads molecular data described in <a href="http://wiki.jmol.org/index.php/File_formats/Formats/XYZ">XYZ file format</a> and transfers it to "ball" like representation, when atoms represented as spheres (balls). This is current version of <a href="https://en.wikipedia.org/wiki/Space-filling_model">CPK molecule representation</a>. For info on <a href="https://en.wikipedia.org/wiki/Jmol">molecule representation types</a>.</p>
<div class="fragment"><div class="line">contextManager m; </div>
<div class="line">m.Update();<span class="comment">//creates context</span></div>
<div class="line"> </div>
<div class="line">xyzReader read;  <span class="comment">//reads data</span></div>
<div class="line">read.Setfile(<span class="stringliteral">&quot;molecule.xyz&quot;</span>);</div>
<div class="line">read.Update();</div>
<div class="line"> </div>
<div class="line">sdfCPKMol mol;  <span class="comment">//</span></div>
<div class="line">mol.SetContext(m.GetOutput());</div>
<div class="line">mol.SetCenter(read.GetOutput1()); <span class="comment">//centers, data stored in std::vector</span></div>
<div class="line">mol.SetTypes(read.GetOutput2()); <span class="comment">//set types of atoms, data stored in std::vector</span></div>
<div class="line">mol.SetMaterialType(0); </div>
<div class="line">mol.Update();</div>
</div><!-- fragment --><p>The other example is reading dynamic scalar data, that represents . Gamess files. The reader performs signed distance transform of data on base of <a href="http://itk.org">Image Processing Toolkit</a>. It generates optix Buffers and Textures Samplers. The optixSDFTexture gets Texture Samplers describing initial and final states of molecule dynamic electron density field and forms dynamic SDF geometry object. </p><div class="fragment"><div class="line">contextManager m;</div>
<div class="line">m.Update();<span class="comment">//creates context</span></div>
<div class="line"> </div>
<div class="line">sdfTextureReader&lt;float&gt; readSDFTex1;</div>
<div class="line">readSDFTex1.SetContext(m.GetOutput());</div>
<div class="line">readSDFTex1.SetSize(139, 150, 160); <span class="comment">//data dimensions</span></div>
<div class="line"> </div>
<div class="line">readSDFTex1.SetThreshold(0.1); <span class="comment">//isolevel of scalar field</span></div>
<div class="line">readSDFTex1.Setfile(<span class="stringliteral">&quot;ed1.txt&quot;</span>);</div>
<div class="line">readSDFTex1.Update();</div>
<div class="line"> </div>
<div class="line">sdfTextureReader&lt;float&gt; readSDFTex2;</div>
<div class="line">readSDFTex2.SetContext(m.GetOutput());</div>
<div class="line">readSDFTex2.SetSize(138, 150, 160);</div>
<div class="line"> </div>
<div class="line">readSDFTex2.SetThreshold(0.1);</div>
<div class="line">readSDFTex2.Setfile(<span class="stringliteral">&quot;ed2.txt&quot;</span>);</div>
<div class="line">readSDFTex2.Update();</div>
<div class="line"> </div>
<div class="line">sdfTexture tex; <span class="comment">//dynamic SDF object creation</span></div>
<div class="line">tex.SetContext(m.GetOutput());</div>
<div class="line">tex.SetTexture(readSDFTex1.GetTexture(), readSDFTex1.GetParam());</div>
<div class="line">tex.SetTexture(readSDFTex2.GetTexture(), readSDFTex1.GetParam());</div>
<div class="line">tex.Update();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14"></a>
Mapper, Actor, Renderer</h1>
<p>Mapper, Actor and Renderer classes are much simillar to VTK in concept and syntacsis. The Mapper applies a material to the objects (in current implementation with optical or auditory properties). The Mapper is can activate optical or auditory material, depending on type of rendering procedure: rendering optical or auditory properties. For this, in current implementation the Mapper receives optix::Material from Material class (material.GetOutput() procedure ) and description of it's properties in , material.GetType() procedure.</p>
<p>The Renderer is responsible for rendering visual and auditory properties. Whether optical or auditory properties should be rendered, the Renderer operates its actors to activate the necessary visual or auditory model for all created pipelines of data.</p>
<p>Below the code demonstrating the above concepts and syntacsis of Mapper, Actor and Renderer classes basic usage. </p><div class="fragment"><div class="line">vaMaterial mSdf;</div>
<div class="line">mSdf.SetContext(m.GetOutput());</div>
<div class="line">mSdf.Update();</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classva_mapper.html">vaMapper</a> map21;</div>
<div class="line">map21.<a class="code" href="classva_basic_object.html#a084579231006f44f03b6834e723316b6">SetContext</a>(m.GetOutput());</div>
<div class="line">map21.<a class="code" href="classva_mapper.html#a778f09202a3f15a52170f3ad433612f8">SetInput</a>(sdf.GetOutput());</div>
<div class="line">map21.<a class="code" href="classva_mapper.html#aea3ef068acdb6b1b86f7b5ff8b8e38e2">AddMaterial</a>(mSdf.GetOutput(), mSdf.GetType());</div>
<div class="line">map21.<a class="code" href="classva_mapper.html#a840064e5c0c1af154d46cdd9ec4f19ca">Update</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classva_actor.html">vaActor</a> acSdf1;</div>
<div class="line">acSdf1.<a class="code" href="classva_basic_actor.html#af3c54b025cbceb8e1ffffcf8b7b4327b">SetContext</a>(m.GetOutput());</div>
<div class="line">acSdf1.<a class="code" href="classva_basic_actor.html#a6fc2fc28aa7585768cf3b083224b0c3e">AddMapper</a>(&amp;map21);</div>
<div class="line">acSdf1.<a class="code" href="classva_basic_actor.html#aaab78113ac80441c1cc774f187b1b385">Update</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">ren.AddActor(&amp;acSdf1);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">....</div>
<div class="line">ren.LaunchAuditoryContext(); <span class="comment">//compute auditory ray-tracing</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">ren.LaunchOpticContext();<span class="comment">// compute optical ray-tracing</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15"></a>
GUI  and interaction</h1>
<p>The GUI procedures are implemented on base of <a href="https://github.com/glfw/glfw">GLFW</a> and <a href="https://github.com/ocornut/imgui">ImGUI</a> libraries. A custom GUI can be easily implemented on base of those libraries and integrated to API pipeline.</p>
<p>The API provides a basic Renderer, GLFW window and Interactor. As far the basic class of PinholeCamera from NVIDIA OPTIX ADVANCED examples was used to render data: </p><div class="fragment"><div class="line">contextManager m;</div>
<div class="line">m.Update();<span class="comment">//creates context</span></div>
<div class="line"> </div>
<div class="line">PinholeCamera pinholeCamera;  <span class="comment">//basic camera</span></div>
<div class="line"> </div>
<div class="line">optixRenderer ren;</div>
<div class="line">ren.SetValid(m.GetValid());</div>
<div class="line">ren.SetContext(m.GetOutput());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">ren.SetOpticalDims(windowWidth, windowWidth);</div>
<div class="line">ren.SetCamera(&amp;pinholeCamera);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//set not dynamic</span></div>
<div class="line">ren.SetDynamic(<span class="keyword">false</span>);</div>
<div class="line">ren.SetAuditory(<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//window procedure</span></div>
<div class="line"> </div>
<div class="line">vaWindow optixWindowProc; </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">optixWindowProc.SetDim(windowWidth, windowHeight);</div>
<div class="line">optixWindowProc.SetRenderer(&amp;ren);</div>
<div class="line">optixWindowProc.SetContext(m.GetOutput()); <span class="comment">//returns context</span></div>
<div class="line">optixWindowProc.SetCamera(&amp;pinholeCamera);</div>
<div class="line"> </div>
<div class="line">vaRenderWindowInteractor iren; <span class="comment">//TODO always check that basic still works</span></div>
<div class="line">iren.SetWindow(&amp;optixWindowProc);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassva_mapper_html_a840064e5c0c1af154d46cdd9ec4f19ca"><div class="ttname"><a href="classva_mapper.html#a840064e5c0c1af154d46cdd9ec4f19ca">vaMapper::Update</a></div><div class="ttdeci">virtual void Update()</div><div class="ttdef"><b>Definition:</b> optixAbstractMaterial.cpp:117</div></div>
<div class="ttc" id="aclassva_actor_html"><div class="ttname"><a href="classva_actor.html">vaActor</a></div><div class="ttdef"><b>Definition:</b> vaActor.h:48</div></div>
<div class="ttc" id="aclassva_mapper_html"><div class="ttname"><a href="classva_mapper.html">vaMapper</a></div><div class="ttdoc">A basic mapper that suggest application of one visual and one auditory material to one geometry insta...</div><div class="ttdef"><b>Definition:</b> optixAbstractMaterial.h:168</div></div>
<div class="ttc" id="aclassva_basic_object_html_a084579231006f44f03b6834e723316b6"><div class="ttname"><a href="classva_basic_object.html#a084579231006f44f03b6834e723316b6">vaBasicObject::SetContext</a></div><div class="ttdeci">virtual void SetContext(optix::Context &amp;context)</div><div class="ttdef"><b>Definition:</b> vaBasicObject.h:26</div></div>
<div class="ttc" id="aclassva_basic_actor_html_aaab78113ac80441c1cc774f187b1b385"><div class="ttname"><a href="classva_basic_actor.html#aaab78113ac80441c1cc774f187b1b385">vaBasicActor::Update</a></div><div class="ttdeci">void Update()</div><div class="ttdef"><b>Definition:</b> optixBasicActor.cpp:9</div></div>
<div class="ttc" id="aclassva_basic_actor_html_af3c54b025cbceb8e1ffffcf8b7b4327b"><div class="ttname"><a href="classva_basic_actor.html#af3c54b025cbceb8e1ffffcf8b7b4327b">vaBasicActor::SetContext</a></div><div class="ttdeci">virtual void SetContext(optix::Context &amp;context)</div><div class="ttdef"><b>Definition:</b> optixBasicActor.h:46</div></div>
<div class="ttc" id="aclassva_basic_actor_html_a6fc2fc28aa7585768cf3b083224b0c3e"><div class="ttname"><a href="classva_basic_actor.html#a6fc2fc28aa7585768cf3b083224b0c3e">vaBasicActor::AddMapper</a></div><div class="ttdeci">void AddMapper(vaMapper *map)</div><div class="ttdef"><b>Definition:</b> optixBasicActor.h:51</div></div>
<div class="ttc" id="aclassva_mapper_html_a778f09202a3f15a52170f3ad433612f8"><div class="ttname"><a href="classva_mapper.html#a778f09202a3f15a52170f3ad433612f8">vaMapper::SetInput</a></div><div class="ttdeci">void SetInput(optix::Geometry g)</div><div class="ttdef"><b>Definition:</b> optixAbstractMaterial.h:173</div></div>
<div class="ttc" id="aclassva_mapper_html_aea3ef068acdb6b1b86f7b5ff8b8e38e2"><div class="ttname"><a href="classva_mapper.html#aea3ef068acdb6b1b86f7b5ff8b8e38e2">vaMapper::AddMaterial</a></div><div class="ttdeci">void AddMaterial(optix::Material m, MaterialDesc desc)</div><div class="ttdef"><b>Definition:</b> optixAbstractMaterial.cpp:168</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
